{
  "@context": {
    "cco": "http://www.ontologyrepository.com/CommonCoreOntologies/",
    "bfo": "http://purl.obolibrary.org/obo/",
    "rdfs": "http://www.w3.org/2000/01/rdf-schema#",
    "owl": "http://www.w3.org/2002/07/owl#",
    "sh": "http://www.w3.org/ns/shacl#",
    "xsd": "http://www.w3.org/2001/XMLSchema#",
    "ex": "http://example.org/dataviz#"
  },
  "@graph": [

    /* =========================================================
       LAYER 1: REALIST ONTOLOGY (The Semantics) 
       ========================================================= */
       
    {
      "@id": "ex:VisualizationSpecification",
      "@type": "owl:Class",
      "rdfs:subClassOf": "cco:DirectiveInformationContentEntity",
      "rdfs:label": "Visualization Specification"
    },
    {
      "@id": "ex:BarChartSpecification",
      "@type": "owl:Class",
      "rdfs:subClassOf": "ex:VisualizationSpecification",
      "rdfs:label": "Bar Chart Specification Concept"
    },
    {
      "@id": "ex:DataEncoding",
      "@type": "owl:Class",
      "rdfs:subClassOf": "cco:InformationContentEntity",
      "rdfs:label": "Data Encoding Concept",
      "rdfs:comment": "The directive that maps a data field to a visual channel."
    },
    {
      "@id": "ex:VisualChannel",
      "@type": "owl:Class",
      "rdfs:subClassOf": "cco:InformationContentEntity",
      "rdfs:label": "Visual Channel Concept"
    },
    {
      "@id": "ex:XPositionChannel",
      "@type": "owl:Class",
      "rdfs:subClassOf": "ex:VisualChannel",
      "rdfs:label": "X-Axis Position Channel"
    },
    {
      "@id": "ex:YPositionChannel",
      "@type": "owl:Class",
      "rdfs:subClassOf": "ex:VisualChannel",
      "rdfs:label": "Y-Axis Position Channel"
    },
    {
      "@id": "ex:AggregateOperation",
      "@type": "owl:Class",
      "rdfs:subClassOf": "cco:InformationContentEntity"
    },
    {
      "@id": "ex:VisualizationRenderingProcess",
      "@type": "owl:Class",
      "rdfs:subClassOf": "bfo:Process",
      "rdfs:label": "Visualization Rendering Process"
    },

    /* =========================================================
       LAYER 2 & 3: SHACL VALIDATION + JSON MAPPING 
       ========================================================= */

    {
      "@id": "ex:BarChartSpecificationShape",
      "@type": "sh:NodeShape",
      "sh:targetClass": "ex:BarChartSpecification",
      "rdfs:label": "Bar Chart Validation Shape",
      "ex:jsonType": "object",
      "sh:property": [
        {
          "sh:path": "ex:hasType",
          "sh:in": [{"@value": "bar", "@type": "xsd:string"}],
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "type",
          "ex:jsonType": "string"
        },
        {
          "sh:path": "ex:hasDataSource",
          "sh:nodeKind": "sh:IRI",
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "data.source",
          "ex:jsonType": "string"
        },
        {
          "sh:path": "ex:hasGroupBy",
          "sh:node": "ex:GroupByEncodingShape",
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "groupBy",
          "ex:jsonType": "object"
        },
        {
          "sh:path": "ex:hasMeasure",
          "sh:node": "ex:MeasureEncodingShape",
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "measure",
          "ex:jsonType": "object"
        }
      ]
    },

    /* --- GroupBy Encoding Sub-Shape (Categorical -> X Axis) --- */
    {
      "@id": "ex:GroupByEncodingShape",
      "@type": "sh:NodeShape",
      "sh:targetClass": "ex:DataEncoding",
      "sh:property": [
        {
          "sh:path": "ex:mapsToChannel",
          "sh:hasValue": {"@id": "ex:XPositionChannel"},
          "rdfs:comment": "ONTOLOGY ONLY: Enforces that the groupBy field maps to the X Axis. No ex:jsonPath means it stays out of the frontend schema."
        },
        {
          "sh:path": "ex:field",
          "sh:datatype": "xsd:string",
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "field",
          "ex:jsonType": "string"
        },
        {
          "sh:path": "ex:orderDirection",
          "sh:in": [{"@value": "asc", "@type": "xsd:string"}, {"@value": "desc", "@type": "xsd:string"}],
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "order.direction",
          "ex:jsonType": "string"
        }
      ]
    },

    /* --- Measure Encoding Sub-Shape (Quantitative -> Y Axis) --- */
    {
      "@id": "ex:MeasureEncodingShape",
      "@type": "sh:NodeShape",
      "sh:targetClass": "ex:DataEncoding",
      "sh:property": [
        {
          "sh:path": "ex:mapsToChannel",
          "sh:hasValue": {"@id": "ex:YPositionChannel"},
          "rdfs:comment": "ONTOLOGY ONLY: Enforces that the aggregated measure maps to the Y Axis."
        },
        {
          "sh:path": "ex:field",
          "sh:datatype": "xsd:string",
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "field",
          "ex:jsonType": "string"
        },
        {
          "sh:path": "ex:aggregate",
          "sh:in": [
            {"@value": "sum", "@type": "xsd:string"}, 
            {"@value": "mean", "@type": "xsd:string"},
            {"@value": "count", "@type": "xsd:string"}
          ],
          "sh:minCount": 1,
          "sh:maxCount": 1,
          "ex:jsonPath": "aggregate",
          "ex:jsonType": "string"
        }
      ]
    }
  ]
}
